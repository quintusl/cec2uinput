#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	# Set Rust flags and target for cross-compilation
	if [ -n "${DEB_HOST_ARCH}" ]; then \
		export CARGO_BUILD_TARGET=$$(case "${DEB_HOST_ARCH}" in \
			"amd64") echo "x86_64-unknown-linux-gnu" ;; \
			"arm64") echo "aarch64-unknown-linux-gnu" ;; \
			"armhf") echo "armv7-unknown-linux-gnueabihf" ;; \
			*) echo "unsupported-architecture" ;; \
		esac); \
		export RUSTFLAGS="${RUSTFLAGS} -C linker=$$(case "${DEB_HOST_ARCH}" in \
			"amd64") echo "gcc" ;; \
			"arm64") echo "aarch64-linux-gnu-gcc" ;; \
			"armhf") echo "arm-linux-gnueabihf-gcc" ;; \
		esac)"; \
	fi
	cargo build --release --target $(CARGO_BUILD_TARGET)

override_dh_auto_install:
	install -d debian/cec2uinput/usr/bin
ifdef CARGO_BUILD_TARGET
	install -D -m755 target/$(CARGO_BUILD_TARGET)/release/cec2uinput debian/cec2uinput/usr/bin/cec2uinput
else
	install -D -m755 target/release/cec2uinput debian/cec2uinput/usr/bin/cec2uinput
endif
	install -d debian/cec2uinput/etc
	install -d debian/cec2uinput/etc/cec2uinput
	install -m 640 config/config.yml debian/cec2uinput/etc/cec2uinput/config.yml
	install -d debian/cec2uinput/lib/systemd/system
	install -m 644 config/cec2uinput.service debian/cec2uinput/lib/systemd/system/
